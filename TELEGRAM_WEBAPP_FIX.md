# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Telegram Web App (–û–±–Ω–æ–≤–ª–µ–Ω–æ 27.08.2025)

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Telegram –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä—ã–π –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∞–ª –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `telegramDetection.js` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram:
- –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: `window.Telegram?.WebApp` –∏ `typeof tg.ready === 'function'`
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è iOS Safari —Ä–µ–∂–∏–º–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `initData` –∏ `initDataUnsafe`
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ initData
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∞ initData –Ω–∞ backend.
**–†–µ—à–µ–Ω–∏–µ**: 
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ `tg.initData` –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `tg.initDataUnsafe` —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö initData –≤ iOS Safari —Ä–µ–∂–∏–º–µ

### 3. –£–ª—É—á—à–µ–Ω–∞ backend –≤–∞–ª–∏–¥–∞—Ü–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: Backend —Å–æ–∑–¥–∞–≤–∞–ª —Å–ª—É—á–∞–π–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.
**–†–µ—à–µ–Ω–∏–µ**: 
- –ò—Å–ø–æ–ª—å–∑—É–µ–º fingerprint –Ω–∞ –æ—Å–Ω–æ–≤–µ IP + User-Agent –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö guest –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram
- –õ—É—á—à–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 4. –£–ø—Ä–æ—â–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –≤ App.jsx.
**–†–µ—à–µ–Ω–∏–µ**: 
- –í—ã–Ω–µ—Å–ª–∏ –≤—Å—é –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
- –£–º–µ–Ω—å—à–∏–ª–∏ timeout –¥–æ 300ms
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev/production —Ä–µ–∂–∏–º–æ–≤

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp API
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã Telegram WebApp –º–µ—Ç–æ–¥–æ–≤.
**–†–µ—à–µ–Ω–∏–µ**: 
- `tg.ready()` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `tg.expand()` - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
- `tg.setHeaderColor()` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
- `tg.enableClosingConfirmation()` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production:

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env —Ñ–∞–π–ª)
```bash
# –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è production:
DANGEROUSLY_BYPASS_AUTH=false

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
POSTGRES_USER=di_admin
POSTGRES_PASSWORD=didi1234didi
POSTGRES_DB=di
POSTGRES_PORT=5433
BACKEND_PORT=9000
USE_MOCK_API=false
FRONTEND_PORT=8080
VITE_GOOGLE_PLACES_API_KEY=your_google_places_api_key_here
OPENAI_API_KEY=your_openai_api_key_here
DEEPSEEK_API_KEY=your_deepseek_api_key_here
USE_OPENAI=true
GOOGLE_GEOCODING_API_KEY=your_google_api_key_here
TELEGRAM_BOT_TOKEN=your_secret_bot_token_here
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ HTTPS. Telegram Web Apps —Ç—Ä–µ–±—É—é—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ –≤ @BotFather
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ URL –≤–∞—à–µ–≥–æ Web App –≤ @BotFather:
```
https://dream-interpretation.ru
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –∑–∞–≥–ª—É—à–∫–∞):
- –û—Ç–∫—Ä–æ–π—Ç–µ https://dream-interpretation.ru –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Telegram"

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Telegram:
- –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ Web App
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –ª–æ–≥–∏:
  ```
  [App] üöÄ Starting app initialization...
  [App] üîç Telegram environment detection result: {isTelegram: true, method: "webapp_api", hasInitData: true, hasUser: true}
  [App] ‚úÖ Telegram environment detected
  [App] WebApp initialization: success
  [API] Telegram environment check: {isTelegram: true, method: "webapp_api", hasInitData: true, initDataLength: 245}
  [API] Using Telegram initData, length: 245
  [ProfileContext] Starting profile fetch...
  ```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ backend –ª–æ–≥–æ–≤:
–í –ª–æ–≥–∞—Ö Docker –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
  ```
  [AUTH] Creating guest user with fingerprint: abc12345 (–¥–ª—è iOS Safari —Ä–µ–∂–∏–º–∞)
  [AUTH] Valid Telegram user authenticated: 123456789 (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞)
  ```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@5.129.237.108

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/your/project

# 3. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# 4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
docker compose down
docker system prune -f

# 5. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞
docker compose build --no-cache
docker compose up -d

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
docker compose logs -f

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è PowerShell (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Windows):

```powershell
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
ssh root@5.129.237.108 "cd /path/to/your/project; git pull; docker compose down; docker system prune -f; docker compose build --no-cache; docker compose up -d"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
ssh root@5.129.237.108 "cd /path/to/your/project; docker compose logs -f"
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Docker –æ–±—Ä–∞–∑—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –≤–µ—Ä—Å–∏—è—Ö Telegram.
