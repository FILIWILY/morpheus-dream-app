# ‚úÖ Whisper Integration - –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Docker Compose
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `whisper` —Å faster-whisper-server (CPU)
- ‚úÖ –ú–æ–¥–µ–ª—å: **small** (~1GB)
- ‚úÖ Volume –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π
- ‚úÖ Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 2. Backend
- ‚úÖ –°–æ–∑–¥–∞–Ω `backend/src/services/whisper.js` –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint `POST /processDreamAudio` 
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω multer –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `interpretDream()`

### 3. Dependencies
- ‚úÖ `multer` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ `form-data` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Whisper
- ‚úÖ `node-fetch` - HTTP –∑–∞–ø—Ä–æ—Å—ã

### 4. Frontend
- ‚úÖ –£–∂–µ –≥–æ—Ç–æ–≤! `useAudioRecorder.js` + `RecordingPage.jsx`
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ –Ω–∞ `/processDreamAudio`

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ .env

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ:
WHISPER_PORT=8000
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ backend

```bash
cd backend
npm install
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Compose

```bash
docker-compose down
docker-compose build --no-cache backend
docker-compose up -d
```

**‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:** Whisper –∑–∞–≥—Ä—É–∑–∏—Ç –º–æ–¥–µ–ª—å ~1GB, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 2-5 –º–∏–Ω—É—Ç!

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Whisper –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker-compose logs whisper -f

# –û–∂–∏–¥–∞–π—Ç–µ:
# "Loading model small..."
# "Model loaded successfully"
# "Starting server on 0.0.0.0:8000"
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:3001`
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —Å—Ñ–µ—Ä—É
3. –ó–∞–ø–∏—à–∏—Ç–µ –≥–æ–ª–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ú–Ω–µ –ø—Ä–∏—Å–Ω–∏–ª—Å—è —Å–æ–Ω...")
4. –ù–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑ —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
5. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É
6. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –ª–æ–≥–∏:

```bash
docker-compose logs backend -f

# –û–∂–∏–¥–∞–π—Ç–µ:
# [Server] üé§ Audio transcription request...
# [Whisper] Starting transcription...
# [Whisper] ‚úÖ Transcription successful
# [Server] ‚úÖ Transcription successful: "–ú–Ω–µ –ø—Ä–∏—Å–Ω–∏–ª—Å—è —Å–æ–Ω..."
# [Server] ü§ñ Starting interpretation...
# [Server] ‚úÖ Dream interpretation complete
```

---

## üíª –í–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä - –ò–¥–µ–∞–ª–µ–Ω!

**–í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- CPU: Intel i7-8750H (6 cores, 2.2GHz) ‚úÖ
- RAM: 8 GB ‚úÖ
- GPU: Intel UHD 630 (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Whisper)

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- 10 —Å–µ–∫—É–Ω–¥ –∞—É–¥–∏–æ ‚Üí **1-2 —Å–µ–∫—É–Ω–¥—ã** –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚ö°
- 30 —Å–µ–∫—É–Ω–¥ –∞—É–¥–∏–æ ‚Üí **3-6 —Å–µ–∫—É–Ω–¥** –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚ö°
- 60 —Å–µ–∫—É–Ω–¥ –∞—É–¥–∏–æ ‚Üí **6-12 —Å–µ–∫—É–Ω–¥** –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚ö°

**–í—ã–≤–æ–¥:** –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!

---

## üß™ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. Whisper —Ä–∞–±–æ—Ç–∞–µ—Ç?

```bash
curl http://localhost:8000/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status":"ok"}
```

### 2. Backend –≤–∏–¥–∏—Ç Whisper?

```bash
docker-compose exec backend curl http://whisper:8000/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status":"ok"}
```

### 3. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ browser:

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network
2. –ó–∞–ø–∏—à–∏—Ç–µ –∞—É–¥–∏–æ
3. –°–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/processDreamAudio`
4. Response –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç —Å–Ω–∞ —Å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ–º

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Whisper –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs whisper

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ
docker-compose down
docker volume rm di_whisper_models
docker-compose up -d whisper
```

### Backend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Whisper

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏
docker network inspect di_default

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# - morpheus-backend
# - morpheus-whisper
```

### –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø—É—Å—Ç–∞—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–∑—Ä–µ—à—ë–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ì–æ–≤–æ—Ä–∏—Ç–µ –≥—Ä–æ–º—á–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∞—É–¥–∏–æ –≤ –ª–æ–≥–∞—Ö (–º–∏–Ω–∏–º—É–º 1000 bytes)

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser           ‚îÇ
‚îÇ  (RecordingPage)    ‚îÇ –ó–∞–ø–∏—Å—å WebM –∞—É–¥–∏–æ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ POST /api/processDreamAudio
           ‚îÇ FormData: { audiofile, lang, date }
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Backend           ‚îÇ
‚îÇ  (Node.js:9000)     ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ  1. Multer          ‚îÇ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª
‚îÇ  2. whisper.js      ‚îÇ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç
‚îÇ  3. interpretDream  ‚îÇ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç
‚îÇ  4. database.js     ‚îÇ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ POST /v1/audio/transcriptions
           ‚îÇ FormData: { file, language }
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Whisper Service    ‚îÇ
‚îÇ  (Docker:8000)      ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ  - Model: small     ‚îÇ ~1GB
‚îÇ  - Device: CPU      ‚îÇ
‚îÇ  - faster-whisper   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìù API

### POST `/processDreamAudio`

**Request:**
```http
POST /api/processDreamAudio
Content-Type: multipart/form-data

audiofile: (file) WebM audio
lang: "ru" | "en" | "es" | "de" | "fr"
date: "YYYY-MM-DD" | "today"
```

**Response:**
```json
{
  "id": "uuid",
  "userId": "telegram_id",
  "date": "2025-10-18",
  "dreamText": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–Ω–∞",
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–Ω–∞",
  "introduction": "–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ...",
  "symbols": [
    {
      "id": "uuid",
      "title": "–û–±—Ä–∞–∑ 1",
      "interpretation": "–¢–æ–ª–∫–æ–≤–∞–Ω–∏–µ...",
      "category": null,
      "order": 1
    }
  ],
  "advice": {
    "title": "–°–æ–≤–µ—Ç",
    "content": "–¢–µ–∫—Å—Ç —Å–æ–≤–µ—Ç–∞..."
  }
}
```

---

## üéØ Next Steps

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

1. ‚úÖ **–í—Å—ë —É–∂–µ –≥–æ—Ç–æ–≤–æ!** –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–µ
2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞..." –Ω–∞ Frontend
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É –∑–∞–ø–∏—Å–∏ (max 2 –º–∏–Ω—É—Ç—ã)
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∑–∞–ø–∏—Å—å"

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ):

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å `tiny` –≤–º–µ—Å—Ç–æ `small` (–≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ)
- –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ GPU support (–≤ 10-20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `ReadMe/WHISPER_INTEGRATION.md`
- **API Documentation:** `ReadMe/API_DOCUMENTATION.md`
- **Production Deployment:** `ReadMe/PRODUCTION_DEPLOYMENT.md`

---

## ‚úÖ Checklist

- [x] Docker Compose –æ–±–Ω–æ–≤–ª—ë–Ω
- [x] Backend —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω
- [x] Endpoint –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Dependencies —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [ ] .env –æ–±–Ω–æ–≤–ª—ë–Ω (WHISPER_PORT=8000)
- [ ] npm install –≤ backend
- [ ] docker-compose up -d
- [ ] –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

---

**üéâ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!**

–ü—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —à–∞–≥–∏ 1-5 –≤—ã—à–µ –∏ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç!

---

**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Ready to Test

